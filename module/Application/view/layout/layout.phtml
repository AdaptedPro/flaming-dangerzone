<?php echo $this->doctype(); ?>

<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="author" content=""> 
		<?php 
		if (isset($_SERVER['HTTP_USER_AGENT']) &&
		(strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE') !== false))
			header('X-UA-Compatible: IE=edge,chrome=1');
		?>        
        
        <?php echo $this->headMeta()
            ->appendName('viewport', 'width=device-width, initial-scale=1.0')
        ?>
        
	    <?php echo $this->headTitle($this->translate('Utatis'))->setSeparator(' - ')->setAutoEscape(false) ?>
	    
        <?php /* Styles */?>
        <?php echo $this->headLink(array('rel' => 'shortcut icon', 'type' => 'image/vnd.microsoft.icon', 'href' => $this->basePath() . '/img/favicon.ico'))                        
        				->prependStylesheet($this->basePath() . '/css/default.css')
        				->prependStylesheet($this->basePath() . '/css/cover.css')
        				->prependStylesheet($this->basePath() . '/css/bootstrap.min.css')
        				->prependStylesheet($this->basePath() . '/css/bootstrap-theme.min.css')
        				->prependStylesheet($this->basePath() . '/css/sticky-footer-navbar.css')
        ; ?>        
        <?php /* Scripts */?>
        <?php echo $this->headScript()
            ->prependFile($this->basePath() . '/js/bootstrap.min.js')
            ->prependFile($this->basePath() . '/js/jquery.min.js')
            ->prependFile($this->basePath() . '/js/docs.min.js')
            ->prependFile($this->basePath() . '/js/respond.min.js', 'text/javascript', array('conditional' => 'lt IE 9',))
            ->prependFile($this->basePath() . '/js/html5shiv.js',   'text/javascript', array('conditional' => 'lt IE 9',))
        ; ?>
        
    </head>
    <body>
    
		<div id="fb-root"></div>
		<script type="text/javascript">
		    window.fbAsyncInit = function() {
		    	  FB.init({
		    	    appId      : '200668723295785',
		    	    status     : true, // check login status
		    	    cookie     : true, // enable cookies to allow the server to access the session
		    	    xfbml      : true  // parse XFBML
		    	  });
		
		    	  FB.Event.subscribe('auth.authResponseChange', function(response) {
		    	    if (response.status === 'connected') {
		    	      getFBUser(1);
		    	    } else if (response.status === 'not_authorized') {
		    	    	getFBUser(2);
		    	    } else {
		    	    	getFBUser(2);
		    	    }
		    	  });
		    };
	
	    	(function(d){
	    	   var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	    	   if (d.getElementById(id)) {return;}
	    	   js = d.createElement('script'); js.id = id; js.async = true;
	    	   js.src = "//connect.facebook.net/en_US/all.js";
	    	   ref.parentNode.insertBefore(js, ref);
	    	}(document));

            function getFBUser(x) 
            {
				if (x==1) {
					FB.api('/me', function(response) {
						user_logged_in(response);
					});
				} else if(x==2) {
	                FB.login(function(response) {
	                	if (response.authResponse) {	                		
		                    FB.api('/me', function(response) {
		                    	if (response.verified == true) {
		                    		user_logged_in(response);
			                    }
			                });                	
	                	}		                
		            }, {scope: 'email,user_likes,create_event,user_birthday'});                
	            } 
			}

			function user_logged_in(resp)
			{
                $.ajax({
                    type:'POST',
                    url:'/user/facebook',
                    data:resp,
                    success: function (msg) {
                    	console.log(msg);
                    	if (msg['reply']) {
                    		window.location.replace("/");
                    	}
                    }, 
                    fail: function () {
                        alert('Fail Alert');                              
                    }
                });
			}	    	  
		</script>    

	    <div class="site-wrapper">
	        <div class="site-wrapper-inner">
	            <div class="cover-container">
	                <div class="masthead clearfix">
	                    <div class="inner">
	                    <h3 class="masthead-brand"><a href="/"><img src="<?php echo $this->basePath(); ?>/img/logo-utatis.png" alt="Utatis" /></a></h3>
	                    <ul class="nav masthead-nav">
	                        <!-- <li class="active"><a href="/">Home</a></li>  -->
	                        <li><a href="/download">Download</a></li>
	                        <li><a href="/faq">FAQ</a></li>
	                        <li><a href="/user/signin">Sign In</a></li>
	                        <!-- 
	                        <li><button class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-sm">Login</button></li>
	                         -->
	                    </ul> 
	                </div>
	            </div>
	            
	            <?php echo $this->content; ?>
	      
	            <div class="mastfoot">
	                <div class="inner">
	                    <p><small>&copy; <?php echo date('Y'); ?> All Rights Reserved.</small></p>
	                </div>
	            </div>
	        </div>
	      </div>
	    </div>                 

		<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-sm">
		    <div class="modal-content">
		    
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		        <h4 class="modal-title" id="myModalLabel">Please sign in</h4>
		      </div>    
		
		      <div class="modal-body">
				<form id="login_form" class="form-signin" role="form"
					action="user/signin" method="post">
					
					<h2 class="form-signin-heading">
						<div class="fb-login-button" data-max-rows="1" data-size="large"
							data-show-faces="false" data-auto-logout-link="true"></div>
					</h2>
					
					<?php echo (isset($_SESSION['login_message'])?'<p class="red">'.$_SESSION['login_message'].'</p>':''); ?>
					<?php if( isset($_SESSION['login_message']) ) unset($_SESSION['login_message']); ?>
					<input type="email" name="email" class="form-control"
						placeholder="Email address" required autofocus> <input type="password"
						name="password" class="form-control" placeholder="Password" required>
					<label class="checkbox"> <input type="checkbox" value="remember-me">
						Remember me
					</label>
					
					<button class="btn btn-lg btn-primary btn-block" name="go"
						type="submit">Sign in</button>
						
				</form>
		      </div>
		      
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        <button type="button" class="btn btn-primary">Save changes</button>
		      </div>
		      		
		    </div>
		  </div>
		</div>

    </body>
</html>